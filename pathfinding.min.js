function drawGrid(){contextOver.strokeStyle="rgba(0,0,0,0.3)";for(var t=0;t<totalGridX;t++){contextOver.moveTo(t*cellSize+.5,canvas.height+30),contextOver.lineTo(t*cellSize+.5,0);for(var e=0;e<totalGridY;e++)contextOver.moveTo(0,e*cellSize+.5),contextOver.lineTo(canvas.width+30,e*cellSize+.5)}}function setData(t,e){started||(0==currData?(currItem[map[t][e].content]--,1==map[t][e].content?(startX=-1,startY=-1):2==map[t][e].content&&(goalX=-1,goalY=-1),map[t][e].content=0,valueF[t][e]=valueG[t][e]=valueH[t][e]=0):map[t][e].content==currData&&2==control?(map[t][e].content=0,valueF[t][e]=valueG[t][e]=valueH[t][e]=0,currItem[currData]--,1==currData?(startX=-1,startY=-1):2==currData&&(goalX=-1,goalY=-1)):0==map[t][e].content&&0==control&&currItem[currData]<max[currData]&&(1==currData?(startX=t,startY=e):2==currData&&(goalX=t,goalY=e),map[t][e].content=currData,currItem[currData]++),draw())}function initialMap(){for(var t=new Array(totalGridX),e=0;e<totalGridX;e++){t[e]=new Array(totalGridY);for(var a=0;a<totalGridY;a++)t[e][a]={content:0,visited:0}}return t}function initialArray(){for(var t=new Array(totalGridX),e=0;e<totalGridX;e++){t[e]=new Array(totalGridY);for(var a=0;a<totalGridY;a++)t[e][a]=0}return t}function draw(){-1!=startX&&-1!=startY&&(map[startX][startY].content=1),-1!=goalX&&-1!=goalY&&(map[goalX][goalY].content=2),context.font="10px Helvetica",context.textAlign="center",context.clearRect(0,0,canvas.width,canvas.height);for(var t=0;t<totalGridX;t++)for(var e=0;e<totalGridY;e++)1==map[t][e].content?(context.fillStyle="rgb(0,255,0)",context.fillRect(t*cellSize+.5,e*cellSize+.5,cellSize,cellSize)):2==map[t][e].content?(context.fillStyle="rgb(255,0,0)",context.fillRect(t*cellSize+.5,e*cellSize+.5,cellSize,cellSize)):3==map[t][e].content?(context.fillStyle="rgb(0,0,0)",context.fillRect(t*cellSize+.5,e*cellSize+.5,cellSize,cellSize)):5==map[t][e].content?(context.fillStyle="#A5A5A6",context.fillRect(t*cellSize+.5,e*cellSize+.5,cellSize,cellSize)):6==map[t][e].content?(context.fillStyle="#CCECF3",context.fillRect(t*cellSize+.5,e*cellSize+.5,cellSize,cellSize)):7==map[t][e].content&&(context.fillStyle="#80D0E1",context.fillRect(t*cellSize+.5,e*cellSize+.5,cellSize,cellSize)),0!=valueF[t][e]&&(context.fillStyle="red",context.fillText(valueG[t][e],t*cellSize+5.5,e*cellSize+10.5),context.fillStyle="blue",context.fillText(valueH[t][e],t*cellSize+20.5,e*cellSize+25.5),context.fillStyle="green",context.fillText(valueF[t][e],t*cellSize+5.5,e*cellSize+25.5))}function reverse(t){for(;null!=t.parent;)map[t.x][t.y].content=1==map[t.x][t.y].content||2==map[t.x][t.y].content?map[t.x][t.y].content:5,t=t.parent;draw()}function inside(t,e){for(var a=0;a<t.length;a++)if(t[a].x==e.x&&t[a].y==e.y)return!0;return!1}window.oncontextmenu=function(){return!1};var comboBox=document.getElementById("select"),canvas=document.getElementById("canvas"),canvasOver=document.getElementById("canvasOver"),algo=document.getElementById("algo"),start=document.getElementById("startAstar"),clear=document.getElementById("clear"),clearWall=document.getElementById("clearWall"),diagonalCheck=document.getElementById("diagonalCheck");canvas.width=canvasOver.width=window.innerWidth,canvas.height=canvasOver.height=window.innerHeight;var context=canvas.getContext("2d"),contextOver=canvasOver.getContext("2d"),starting=null,started=!1,found=!1,max=[1e9,1,1,1e9,1e9],currItem=[0,1,1,0,0],currData=comboBox.selectedIndex,queue=[],openList=[],closedList=[],diagonal=4,dx=[-1,1,0,0,1,1,-1,-1],dy=[0,0,1,-1,1,-1,1,-1],cellSize=30,totalGridX=parseInt(canvas.width/cellSize)+1,totalGridY=parseInt(canvas.height/cellSize)+1,startX=parseInt(totalGridX/3),startY=parseInt(totalGridY/2)-2,goalX=parseInt(totalGridX*(2/3)),goalY=parseInt(totalGridY/2)-2,indexAlgo=algo.selectedIndex,map=initialMap(),valueF=initialArray(),valueG=initialArray(),valueH=initialArray(),down=!1,control=0;canvasOver.onmousedown=function(t){var e=t.clientX,a=t.clientY;control=t.button,down=!0,setData(parseInt(e/cellSize),parseInt(a/cellSize))},canvasOver.onmouseup=function(t){down=!1,control=0},canvasOver.onmousemove=function(t){var e=t.clientX,a=t.clientY;down&&setData(parseInt(e/cellSize),parseInt(a/cellSize))},comboBox.onchange=function(){currData=comboBox.selectedIndex},algo.onchange=function(){indexAlgo=algo.selectedIndex},start.onclick=function(){if(!started){if(started=!0,1!=currItem[1]||1!=currItem[2])return;openList.push({x:startX,y:startY,f:0,g:0,h:0,parent:null}),queue.push({x:startX,y:startY,parent:null}),starting=setInterval(pathfinding[indexAlgo],20)}},diagonalCheck.onchange=function(){started?diagonalCheck.checked=!diagonalCheck.checked:diagonal=diagonalCheck.checked?8:4},clearWall.onclick=function(){started=!1;for(var t=0;t<totalGridX;t++)for(var e=0;e<totalGridY;e++)valueF[t][e]=0,map[t][e]={content:0,visited:0};map[startX][startY].content=1,map[goalX][goalY].content=2,draw(),found=!1,clearInterval(starting),queue=[],starting=null,closedList=[],(openList=[]).push({x:startX,y:startY,f:0,g:0,h:0,parent:null}),queue.push({x:startX,y:startY,parent:null})},clear.onclick=function(){started=!1;for(var t=0;t<totalGridX;t++)for(var e=0;e<totalGridY;e++)valueF[t][e]=0,map[t][e].visited=0,map[t][e].content=1==map[t][e].content||2==map[t][e].content||5==map[t][e].content||6==map[t][e].content||7==map[t][e].content?0:map[t][e].content;map[startX][startY].content=1,map[goalX][goalY].content=2,draw(),found=!1,clearInterval(starting),queue=[],starting=null,closedList=[],(openList=[]).push({x:startX,y:startY,f:0,g:0,h:0,parent:null}),queue.push({x:startX,y:startY,parent:null})};var pathfinding=[function(){var t=queue.shift();if(map[t.x][t.y].visited=1,map[t.x][t.y].content=7,t.x==goalX&&t.y==goalY)return clearInterval(starting),found=!0,void reverse(t);for(var e=0;e<diagonal;e++){var a=t.x+dx[e],n=t.y+dy[e];if(a>=0&&a<totalGridX&&n>=0&&n<totalGridY&&3!=map[a][n].content&&0==map[a][n].visited){var l={x:a,y:n,parent:t};map[a][n].content=6,map[a][n].visited=1,queue.push(l),draw()}}queue.length<=0&&clearInterval(starting)},function(){if(!found){openList.sort(function(t,e){return t.f-e.f});var t=openList.shift();closedList.push(t),map[t.x][t.y].content=7;for(var e=0;e<diagonal;e++){var a=t.x+dx[e],n=t.y+dy[e];if(a>0&&a<totalGridX&&n>0&&n<totalGridY&&3!=map[a][n].content){var l=Math.abs(a-goalX)+Math.abs(n-goalY),r=t.h+1,o=l+r,c={x:a,y:n,f:o,g:l,h:r,parent:t};if(a==goalX&&n==goalY)return found=!0,void reverse(t);if(inside(closedList,c))continue;inside(openList,c)||(valueF[a][n]=o,map[a][n].content=6,valueH[a][n]=r,valueG[a][n]=l,openList.push(c)),draw()}}openList.length<=0&&clearInterval(starting)}}];window.onload=function(){drawGrid(),draw(),contextOver.stroke(),currData=comboBox.selectedIndex=3};